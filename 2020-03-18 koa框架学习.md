<h1 align = "center">koaæ¡†æ¶å­¦ä¹ </h1>

[toc]

ç®€ä»‹ï¼škoaæ˜¯åŸç­çš„expressæ¡†æ¶äººå‘˜å¼€å‘ï¼Œæ˜¯ä¸€ä¸ªå…¨æ–°çš„webæ¡†æ¶ï¼Œè‡´åŠ›äºæˆä¸ºwebåº”ç”¨å’ŒAPIå¼€å‘é¢†åŸŸä¸­çš„ä¸€ä¸ªæ›´å°çš„ã€æ›´å¯Œæœ‰è¡¨ç°åŠ›ã€æ›´å¥å£®çš„åŸºçŸ³ã€‚

ç‰¹ç‚¹: åˆ©ç”¨asyncå‡½æ•°ä¸¢å¼ƒå›è°ƒå‡½æ•°ï¼Œå¹¶å¢å¼ºé”™è¯¯å¤„ç†ã€‚Koaæ²¡æœ‰é¢„è®¾ä»»ä½•é¢„ç½®çš„ä¸­é—´ä»¶ï¼Œå¯å¿«é€Ÿçš„ç¼–å†™æœåŠ¡ç«¯åº”ç”¨ç¨‹åºã€‚

### æ ¸å¿ƒæ¦‚å¿µ

- Koa Application(åº”ç”¨ç¨‹åº)

- Context(ä¸Šä¸‹æ–‡)

- Request(è¯·æ±‚) Response(å“åº”)

  ![image-20200718154709758](/Users/hezhoushuai/Library/Application Support/typora-user-images/image-20200718154709758.png)

### ç¬¬ä¸€ä¸ªkoaåº”ç”¨

1. é¦–å…ˆæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹ä¸­æ‰§è¡Œ`npm init -y`ï¼Œå»ç”Ÿæˆä¸€ä¸ª`package.json`æ–‡ä»¶

2. æ‰§è¡Œ`npm install -S koa`å»å®‰è£…koaåº”ç”¨

3. æ–°å»ºä¸€ä¸ªindex.jsæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­ä¹¦å†™

   ```javascript
   const Koa = require('koa')
   const app = new Koa()
   
   
   app.use(async ctx => {
     ctx.body = 'Hello world!!'
   })
   
   app.listen(3000) // ä½¿æˆ‘ä»¬çš„Koaç¨‹åºè¿è¡Œåœ¨3000ç«¯å£
   ```

4. é€šè¿‡`node index.js`è¿è¡Œæˆ‘ä»¬çš„koaåº”ç”¨ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥`localhost:3000`

   ![image-20200718155604690](/Users/hezhoushuai/Library/Application Support/typora-user-images/image-20200718155604690.png)

   è‡³æ­¤æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª`hellow world koa`åº”ç”¨å°±å·²ç»æˆåŠŸå®Œæˆå•¦ï¼

### koa router

**ç®€ä»‹:** koa-routeræ˜¯ä¸€ä¸ªè·¯ç”±ç®¡ç†æ¨¡å—çš„ä¸­é—´ä»¶,åŸºäºä¸Šé¢æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªkoaç¨‹åºç»§ç»­è¿›è¡Œæ”¹è¿›

```javascript
const Koa = require('koa')
const app = new Koa()
const Router = require('koa-router')

const router = new Router()

router.get('/', ctx => {
  ctx.body = 'Hello world!!'
})

router.get('/api', ctx => {
  ctx.body = 'this routes is /api!!'
})

app.use(router.routes()) // å°†æˆ‘ä»¬ä¸Šé¢ç”³è¯·çš„è·¯å¾„è¿›è¡Œæ³¨å†Œ
  .use(router.allowedMethods()) // æ‹¦æˆªå™¨,æ‹¦æˆªä¸€äº›æ²¡æœ‰çš„è¯·æ±‚ï¼Œä¼šç›´æ¥è¿”å›4xxæˆ–è€…5xxé”™è¯¯

app.listen(3000)
```

æ­¤æ—¶ï¼Œæˆ‘ä»¬è®¿é—®`localhost:3000/api`è¿™æ—¶å€™å°±ä¼šè¿”å›å¯¹åº”çš„å€¼

![è®¿é—®/apiè·¯å¾„](/Users/hezhoushuai/Library/Application Support/typora-user-images/image-20200718161529647.png)

![è®¿é—®/apissè·¯å¾„](/Users/hezhoushuai/Library/Application Support/typora-user-images/image-20200718161601677.png)

### koaå·¥ä½œåŸç†

- æ‰§è¡Œçš„é¡ºåº: é¡ºåºæ‰§è¡Œ

- å›è°ƒçš„é¡ºåº: æ–¹å‘æ‰§è¡Œ

- å…ˆè¿›åå‡º

  ğŸ§…æ´‹è‘±åŸç†![æ´‹è‘±åŸç†](/Users/hezhoushuai/Library/Application Support/typora-user-images/image-20200718162759605.png)

  #### ä¸€ä¸ªç®€å•çš„è¯´æ˜ä¾‹å­

  ```javascript
  const Koa = require('koa')
  const app = new Koa()
  
  const middleware1 = function async(ctx, next) {
      console.log(ctx.request.path)
      console.log('hello this is middleware1')
      next()
      console.log('end the middleware1')
  }
  
  const middleware2 = function async(ctx, next) {
      console.log(ctx.request.path)
      console.log('hello this is middleware2')
      next()
      console.log('end the middleware2')
  }
  
  const middleware3 = function async(ctx, next) {
      console.log(ctx.request.path)
      console.log('hello this is middleware3')
      next()
      console.log('end the middleware3')
  }
  
  app.use(middleware1)
      .use(middleware2)
      .use(middleware3)
  
  
  app.listen(3000)
  ```

  ```verilog
  /apiss
  hello this is middleware1
  /apiss
  hello this is middleware2
  /apiss
  hello this is middleware3
  end the middleware3
  end the middleware2
  end the middleware1
  ```

  ç”±ä»¥ä¸Šçš„è¾“å‡ºç»“æœä¸éš¾ç†è§£ï¼Œåœ¨æˆ‘çš„ç†è§£ä¸­å°±æ˜¯æŒ‰ç…§jsçš„ä¸Šä¸‹æ–‡é¡ºåºæ‰§è¡Œï¼Œå½“é‡åˆ°nextå‡½æ•°çš„æ—¶å€™ä¼šå°†æ”¹ctxç»§ç»­äº¤ç»™ä¸‹ä¸€ä¸ªmiddlewareå»æ‰§è¡Œã€‚å¦‚æœè¿™é‡Œæ²¡æœ‰ä½¿ç”¨nextå‡½æ•°åˆ™koaä¼šè®¤ä¸ºæˆ‘ä»¬å·²ç»æ‰§è¡Œå®Œæ¯•,ä¼šç›´æ¥å°†ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚è€Œæˆ‘ä»¬ä½¿ç”¨äº†nextå‡½æ•°åˆ™å¯ä»¥ç†è§£ä¸ºå°†ä¸‹åˆ—çš„ä¸­é—´ä»¶æ’å…¥å½“å‰nextå‡½æ•°ä½ç½®ã€‚æ•…æœ‰å…ˆè¿›åå‡ºåŸåˆ™ï¼›